<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AwardJet - Unlock the Full Value of Your Points</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e' },
                        accent: { 400: '#fb923c', 500: '#f97316', 600: '#ea580c' }
                    },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Plus Jakarta Sans', system-ui, sans-serif; }
        .gradient-brand { background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 50%, #0c4a6e 100%); }
        .gradient-accent { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
        .gradient-hero { background: linear-gradient(135deg, #0c4a6e 0%, #0369a1 50%, #0ea5e9 100%); }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15); }
        .tab-active { background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%); color: white; }
        .fade-up { animation: fadeUp 0.5s ease-out forwards; opacity: 0; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .value-excellent { color: #10b981; }
        .value-good { color: #0ea5e9; }
        .value-fair { color: #f59e0b; }
        .program-badge { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 11px; color: white; }
        .modal-backdrop { background: rgba(12, 74, 110, 0.8); backdrop-filter: blur(8px); }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">
    <!-- Promo Banner -->
    <div class="bg-orange-500 text-white text-center py-2.5 px-4">
        <span class="text-sm md:text-base">ðŸŽ‰ Launch Special: Get 50% off your first 3 months with code <strong class="font-bold">LAUNCH50</strong></span>
    </div>

    <!-- Nav -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 gradient-brand rounded-xl flex items-center justify-center shadow-lg shadow-brand-500/30">
                        <i class="fas fa-paper-plane text-white text-lg"></i>
                    </div>
                    <span class="text-xl font-bold text-slate-900">Award<span class="text-brand-600">Jet</span></span>
                    <span class="text-xs bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full font-medium ml-1">BETA</span>
                </div>
                <div class="hidden md:flex items-center gap-8">
                    <a href="#features" class="text-slate-600 hover:text-brand-600 font-medium">Features</a>
                    <a href="#pricing" class="text-slate-600 hover:text-brand-600 font-medium">Pricing</a>
                    <a href="#" class="text-slate-600 hover:text-brand-600 font-medium">Blog</a>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="openAuth('login')" id="login-btn" class="px-4 py-2 text-slate-600 hover:text-brand-600 font-medium">Log In</button>
                    <button onclick="openAuth('signup')" class="px-5 py-2.5 gradient-brand text-white rounded-xl font-semibold hover:shadow-lg transition-all">Start Free Trial</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <section class="gradient-hero py-20 md:py-28 px-4">
        <div class="max-w-5xl mx-auto text-center text-white">
            <!-- Trust Badge -->
            <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-4 py-2 mb-8">
                <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                <span class="text-sm font-medium text-white/90">Trusted by 12,000+ points enthusiasts</span>
            </div>

            <!-- Main Headline -->
            <h1 class="text-5xl md:text-6xl lg:text-7xl font-extrabold mb-6 leading-tight">
                Stop Wasting Your<br>
                <span class="text-cyan-300">Miles & Points</span>
            </h1>

            <!-- Subheadline -->
            <p class="text-xl md:text-2xl text-white/80 mb-10 max-w-3xl mx-auto leading-relaxed">
                Search 15+ programs instantly. Find hidden sweet spots.<br>
                Book business class for the price of economy.
            </p>

            <!-- CTA Buttons -->
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-10">
                <button onclick="openAuth('signup')" class="w-full sm:w-auto px-8 py-4 bg-white text-brand-700 rounded-xl font-bold text-lg hover:bg-slate-100 hover:shadow-xl transition-all flex items-center justify-center gap-2">
                    Start 7-Day Free Trial
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button onclick="document.getElementById('content-search').scrollIntoView({behavior:'smooth'})" class="w-full sm:w-auto px-8 py-4 bg-white/10 backdrop-blur border border-white/20 text-white rounded-xl font-bold text-lg hover:bg-white/20 transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-play"></i>
                    See It In Action
                </button>
            </div>

            <!-- Trust Signals -->
            <div class="flex flex-wrap items-center justify-center gap-6 text-sm text-white/70">
                <div class="flex items-center gap-2">
                    <i class="fas fa-shield-alt text-white/50"></i>
                    <span>Bank-level Security</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-ban text-white/50"></i>
                    <span>No Charge for 7 Days</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-clock text-white/50"></i>
                    <span>Cancel Anytime</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Partner Logos Bar -->
    <section class="bg-white border-b border-slate-200 py-6">
        <div class="max-w-6xl mx-auto px-4">
            <p class="text-center text-slate-400 text-sm mb-4">Searching across all major loyalty programs</p>
            <div class="flex flex-wrap items-center justify-center gap-8 text-slate-400">
                <span class="font-semibold">United</span>
                <span class="font-semibold">American</span>
                <span class="font-semibold">Delta</span>
                <span class="font-semibold">Chase</span>
                <span class="font-semibold">Amex</span>
                <span class="font-semibold">British Airways</span>
                <span class="text-brand-600 font-semibold">+9 more</span>
            </div>
        </div>
    </section>

    <!-- Main App -->
    <section class="py-12 px-4">
        <div class="max-w-7xl mx-auto">
            <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-200">
                <!-- Tabs -->
                <div class="flex border-b border-slate-200 bg-slate-50">
                    <button onclick="switchTab('search')" id="tab-search" class="flex-1 py-4 px-6 font-semibold text-center transition tab-active">
                        <i class="fas fa-search mr-2"></i>Flight Search
                    </button>
                    <button onclick="switchTab('optimizer')" id="tab-optimizer" class="flex-1 py-4 px-6 font-semibold text-center transition text-slate-600 hover:bg-slate-100">
                        <i class="fas fa-chart-line mr-2"></i>Optimizer
                    </button>
                    <button onclick="switchTab('alerts')" id="tab-alerts" class="flex-1 py-4 px-6 font-semibold text-center transition text-slate-600 hover:bg-slate-100">
                        <i class="fas fa-bell mr-2"></i>Alerts
                    </button>
                </div>

                <div class="p-6 md:p-8">
                    <!-- Search Tab -->
                    <div id="content-search" class="tab-content">
                        <div class="max-w-4xl mx-auto">
                            <h2 class="text-2xl font-bold text-slate-900 mb-6 text-center">Find ALL Ways to Book Your Flight</h2>
                            <div class="bg-slate-50 rounded-2xl p-6 mb-6">
                                <div class="grid md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">From</label>
                                        <input type="text" id="origin" value="MIA" class="w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none font-medium uppercase">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">To</label>
                                        <input type="text" id="destination" value="MAD" class="w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none font-medium uppercase">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Date</label>
                                        <input type="date" id="travel-date" class="w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none font-medium">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Class</label>
                                        <select id="cabin-class" class="w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none font-medium">
                                            <option value="business">Business</option>
                                            <option value="first">First Class</option>
                                            <option value="economy">Economy</option>
                                        </select>
                                    </div>
                                </div>
                                <button onclick="searchFlights()" class="w-full mt-6 gradient-brand text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg transition-all">
                                    <i class="fas fa-search mr-2"></i>Search All Programs
                                </button>
                            </div>
                        </div>
                        <div id="search-results" class="mt-8 hidden">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-slate-900"><span id="result-route">MIA â†’ MAD</span> <span class="text-brand-600" id="result-count"></span></h3>
                            </div>
                            <div id="results-list" class="space-y-4"></div>
                        </div>
                    </div>

                    <!-- Optimizer Tab -->
                    <div id="content-optimizer" class="tab-content hidden">
                        <div class="max-w-4xl mx-auto text-center py-12">
                            <div class="w-20 h-20 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-lock text-brand-600 text-3xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-900 mb-2">Points Optimizer</h3>
                            <p class="text-slate-500 mb-6">Find the best value for your points - ranked by cents-per-point</p>
                            <button onclick="openAuth('signup')" class="px-8 py-4 gradient-brand text-white rounded-xl font-bold hover:shadow-lg transition-all">
                                Unlock with Pro - $10/month
                            </button>
                        </div>
                    </div>

                    <!-- Alerts Tab -->
                    <div id="content-alerts" class="tab-content hidden">
                        <div class="max-w-4xl mx-auto text-center py-12">
                            <div class="w-20 h-20 bg-accent-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-bell text-accent-600 text-3xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-900 mb-2">Price Drop Alerts</h3>
                            <p class="text-slate-500 mb-6">Get notified when award prices drop on ANY program</p>
                            <button onclick="openAuth('signup')" class="px-8 py-4 gradient-brand text-white rounded-xl font-bold hover:shadow-lg transition-all">
                                Unlock with Pro - $10/month
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section id="pricing" class="py-16 px-4 bg-slate-900">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold text-white text-center mb-12">Simple Pricing</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-slate-800 rounded-2xl p-8 border border-slate-700">
                    <h3 class="text-xl font-bold text-white mb-2">Free</h3>
                    <div class="text-4xl font-bold text-white mb-6">$0<span class="text-slate-400 text-lg">/month</span></div>
                    <ul class="space-y-3 text-slate-300 mb-8">
                        <li><i class="fas fa-check text-slate-500 mr-2"></i>3 searches per day</li>
                        <li><i class="fas fa-times text-slate-600 mr-2"></i><span class="text-slate-500">No optimizer</span></li>
                        <li><i class="fas fa-times text-slate-600 mr-2"></i><span class="text-slate-500">No alerts</span></li>
                    </ul>
                    <button class="w-full py-3 border border-slate-600 text-slate-300 rounded-xl font-semibold">Current Plan</button>
                </div>
                <div class="bg-white rounded-2xl p-8 relative">
                    <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-accent-500 text-white text-xs font-bold px-4 py-1 rounded-full">RECOMMENDED</div>
                    <h3 class="text-xl font-bold text-slate-900 mb-2">Pro</h3>
                    <div class="text-4xl font-bold text-slate-900 mb-6">$10<span class="text-slate-400 text-lg">/month</span></div>
                    <ul class="space-y-3 text-slate-700 mb-8">
                        <li><i class="fas fa-check text-green-500 mr-2"></i><strong>Unlimited</strong> searches</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i>Points optimizer</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i>Unlimited price alerts</li>
                    </ul>
                    <button onclick="handleSubscribe()" class="w-full py-3 gradient-brand text-white rounded-xl font-bold hover:shadow-lg transition-all">
                        Start 7-Day Free Trial
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-md w-full overflow-hidden shadow-2xl relative max-h-[95vh] overflow-y-auto">
            <button onclick="closeAuth()" class="absolute top-4 right-4 w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center text-slate-500 hover:bg-slate-200 z-10">
                <i class="fas fa-times"></i>
            </button>
            <div class="gradient-hero p-6 text-center">
                <h3 class="text-2xl font-bold text-white" id="auth-title">Start Your Free Trial</h3>
                <p class="text-brand-200 mt-2" id="auth-subtitle">7 days free, then $10/month</p>
            </div>
            <div class="p-6">
                <form id="auth-form" onsubmit="handleAuth(event)">
                    <div class="space-y-4">
                        <div id="name-field">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Full Name</label>
                            <input type="text" id="auth-name" placeholder="John Doe" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Email</label>
                            <input type="email" id="auth-email" placeholder="john@example.com" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Password</label>
                            <input type="password" id="auth-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none">
                        </div>

                        <!-- Credit Card Section (Signup only) -->
                        <div id="card-section" class="pt-2">
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-sm font-semibold text-slate-700">Payment Method</label>
                                <div class="flex items-center gap-1">
                                    <i class="fab fa-cc-visa text-blue-600 text-lg"></i>
                                    <i class="fab fa-cc-mastercard text-orange-500 text-lg"></i>
                                    <i class="fab fa-cc-amex text-blue-400 text-lg"></i>
                                </div>
                            </div>

                            <!-- Stripe Card Element Container -->
                            <div id="card-element" class="w-full px-4 py-3.5 border border-slate-200 rounded-xl bg-white"></div>
                            <div id="card-errors" class="text-red-500 text-sm mt-2 hidden"></div>

                            <!-- Trial Guarantee -->
                            <div class="mt-3 p-3 bg-green-50 border border-green-200 rounded-xl">
                                <div class="flex items-start gap-2">
                                    <i class="fas fa-shield-alt text-green-600 mt-0.5"></i>
                                    <div class="text-sm text-green-800">
                                        <strong>You won't be charged today.</strong> Your free trial starts immediately. Cancel anytime before it ends and pay nothing.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="auth-submit-btn" class="w-full mt-6 gradient-brand text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg transition-all flex items-center justify-center gap-2">
                        <span id="submit-text">Start Free Trial</span>
                        <i id="submit-spinner" class="fas fa-spinner fa-spin hidden"></i>
                    </button>

                    <!-- What happens next -->
                    <div id="trial-timeline" class="mt-4 text-center">
                        <p class="text-xs text-slate-500">
                            <i class="fas fa-calendar-check text-brand-500 mr-1"></i>
                            Today: Full access unlocked
                            <span class="mx-2">â†’</span>
                            <i class="fas fa-bell text-amber-500 mr-1"></i>
                            Day 5: Reminder email
                            <span class="mx-2">â†’</span>
                            <i class="fas fa-credit-card text-slate-400 mr-1"></i>
                            Day 8: First charge
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="booking-modal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-xl w-full overflow-hidden shadow-2xl relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeBookingModal()" class="absolute top-4 right-4 w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center text-slate-500 hover:bg-slate-200 z-10">
                <i class="fas fa-times"></i>
            </button>
            <div class="gradient-brand p-6">
                <h3 class="text-xl font-bold text-white">Book Your Award Flight</h3>
                <p class="text-brand-200 text-sm mt-1" id="booking-route-display"></p>
            </div>
            <div class="p-6">
                <div id="booking-details" class="mb-6"></div>

                <!-- Important Notice -->
                <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-info-circle text-amber-500 mt-0.5"></i>
                        <div class="text-sm text-amber-800">
                            <strong>How it works:</strong> We'll open the airline's award booking page. You'll need to log in to your loyalty account to see availability and complete your booking. The route will be pre-filled when possible.
                        </div>
                    </div>
                </div>

                <div id="booking-options" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <script>
        // ============================================
        // VERIFIED WORKING AIRLINE BOOKING URLs
        // Tested January 2026
        // ============================================

        const AIRLINE_URLS = {
            // UNITED - URL parameters work, pre-fills route. Login required for award search.
            'united': {
                name: 'United MileagePlus',
                // f=from, t=to, d=date, tt=1 (one-way), at=1 (award travel), sc=7 (cabin), px=1 (passengers)
                buildUrl: (origin, dest, date, cabin) => {
                    const cabinCode = cabin === 'first' ? '3' : cabin === 'business' ? '2' : '1';
                    return `https://www.united.com/en/us/fsr/choose-flights?f=${origin}&t=${dest}&d=${date}&tt=1&at=1&sc=${cabinCode}&px=1&taxng=1&newHP=True&clm=7`;
                },
                note: 'Route pre-filled. Login to see award prices.',
                supportsDeepLink: true
            },

            // AMERICAN - Award search URL with route parameters
            'american': {
                name: 'American AAdvantage',
                buildUrl: (origin, dest, date, cabin) => {
                    return `https://www.aa.com/booking/find-flights?tripType=oneWay&searchType=Award&locale=en_US&pax=1&adult=1&origin=${origin}&destination=${dest}&departDate=${date}`;
                },
                note: 'Opens award search with route pre-filled.',
                supportsDeepLink: true
            },

            // DELTA - Has URL parameters for award search
            'delta': {
                name: 'Delta SkyMiles',
                buildUrl: (origin, dest, date, cabin) => {
                    return `https://www.delta.com/flight-search/book-a-flight?tripType=ONE_WAY&priceType=Award&originCity=${origin}&destinationCity=${dest}&departureDate=${date}&paxCount=1`;
                },
                note: 'Opens Delta award search.',
                supportsDeepLink: true
            },

            // TURKISH - No URL deep-link support. Opens award booking page.
            'turkish': {
                name: 'Turkish Miles&Smiles',
                buildUrl: (origin, dest, date, cabin) => {
                    // Turkish doesn't support URL parameters - opens award booking page
                    return `https://www.turkishairlines.com/en-int/miles-and-smiles/book-award-tickets/`;
                },
                note: 'Opens award page. Enter MIA â†’ MAD manually.',
                supportsDeepLink: false,
                manualInstructions: 'Click "Award Ticket", enter MIA â†’ MAD, select Business class'
            },

            // BRITISH AIRWAYS - Opens Avios redemption (requires login first)
            'british': {
                name: 'British Airways Avios',
                buildUrl: (origin, dest, date, cabin) => {
                    return `https://www.britishairways.com/travel/redeem/execclub/_gf/en_us`;
                },
                note: 'Login required. Then search MIA â†’ MAD.',
                supportsDeepLink: false,
                manualInstructions: 'Login, then search for your route on the redemption page'
            },

            // AIR FRANCE/KLM - Flying Blue award search
            'airfrance': {
                name: 'Air France Flying Blue',
                buildUrl: (origin, dest, date, cabin) => {
                    return `https://wwws.airfrance.us/search/offers?pax=1:0:0:0:0:0:0:0&cabinClass=BUSINESS&activeConnection=0&connections=${origin}-A>${dest}-A:${date}`;
                },
                note: 'Opens Flying Blue with route.',
                supportsDeepLink: true
            },

            // SINGAPORE - KrisFlyer award search
            'singapore': {
                name: 'Singapore KrisFlyer',
                buildUrl: (origin, dest, date, cabin) => {
                    return `https://www.singaporeair.com/en_UK/ppsclub-krisflyer/redeem/`;
                },
                note: 'Opens KrisFlyer. Login and search manually.',
                supportsDeepLink: false
            },

            // ANA - Award search page
            'ana': {
                name: 'ANA Mileage Club',
                buildUrl: (origin, dest, date, cabin) => {
                    return `https://www.ana.co.jp/en/us/amc/award-reservation/`;
                },
                note: 'Opens ANA award page. Login required.',
                supportsDeepLink: false
            },

            // VIRGIN ATLANTIC - Flying Club
            'virgin': {
                name: 'Virgin Atlantic Flying Club',
                buildUrl: (origin, dest, date, cabin) => {
                    return `https://www.virginatlantic.com/book/flights`;
                },
                note: 'Select "Pay with miles" after searching.',
                supportsDeepLink: false
            },

            // Transfer program portals
            'chase': {
                name: 'Chase Ultimate Rewards',
                buildUrl: () => 'https://ultimaterewardspoints.chase.com/transfer-partners',
                note: 'Transfer points to airline partners',
                supportsDeepLink: false
            },
            'amex': {
                name: 'Amex Membership Rewards',
                buildUrl: () => 'https://global.americanexpress.com/rewards/transfer',
                note: 'Transfer points to airline partners',
                supportsDeepLink: false
            }
        };

        // ============================================
        // DATA
        // ============================================

        const loyaltyPrograms = {
            'chase': { name: 'Chase Ultimate Rewards', code: 'CSP', color: '#1a56db', transferPartners: ['united', 'british', 'airfrance', 'singapore', 'virgin'] },
            'amex': { name: 'Amex Membership Rewards', code: 'MR', color: '#059669', transferPartners: ['delta', 'british', 'airfrance', 'singapore', 'ana', 'virgin'] },
            'united': { name: 'United MileagePlus', code: 'UA', color: '#1e40af', airline: 'United Airlines' },
            'american': { name: 'American AAdvantage', code: 'AA', color: '#0ea5e9', airline: 'American Airlines' },
            'delta': { name: 'Delta SkyMiles', code: 'DL', color: '#7c3aed', airline: 'Delta Air Lines' },
            'british': { name: 'British Airways Avios', code: 'BA', color: '#1e3a8a', airline: 'British Airways' },
            'airfrance': { name: 'Flying Blue', code: 'AF', color: '#2563eb', airline: 'Air France' },
            'singapore': { name: 'KrisFlyer', code: 'SQ', color: '#f59e0b', airline: 'Singapore Airlines' },
            'ana': { name: 'ANA Mileage Club', code: 'NH', color: '#0369a1', airline: 'ANA' },
            'turkish': { name: 'Miles&Smiles', code: 'TK', color: '#dc2626', airline: 'Turkish Airlines' },
            'virgin': { name: 'Flying Club', code: 'VS', color: '#dc2626', airline: 'Virgin Atlantic' }
        };

        const awardCharts = {
            'united': { 'MIA-MAD': { economy: 30000, business: 70000, first: 110000 }, 'MIA-NRT': { economy: 35000, business: 80000, first: 120000 }, 'MIA-LHR': { economy: 30000, business: 70000, first: 110000 } },
            'american': { 'MIA-MAD': { economy: 22500, business: 57500, first: 85000 }, 'MIA-LHR': { economy: 22500, business: 57500, first: 85000 } },
            'british': { 'MIA-MAD': { economy: 13000, business: 50000, first: 68000 }, 'MIA-LHR': { economy: 26000, business: 60000, first: 80000 } },
            'airfrance': { 'MIA-MAD': { economy: 18000, business: 53000, first: 84000 }, 'MIA-CDG': { economy: 27500, business: 61000, first: 99000 } },
            'ana': { 'MIA-NRT': { economy: 35000, business: 75000, first: 105000 } },
            'turkish': { 'MIA-MAD': { economy: 15000, business: 45000, first: 67500 }, 'MIA-IST': { economy: 20000, business: 52500, first: 80000 } },
            'virgin': { 'MIA-LHR': { economy: 15000, business: 47500, first: 57500 } }
        };

        const cashPrices = {
            'MIA-MAD': { economy: 800, business: 3500, first: 7000 },
            'MIA-NRT': { economy: 1200, business: 5500, first: 12000 },
            'MIA-LHR': { economy: 750, business: 3200, first: 6500 }
        };

        let userState = JSON.parse(localStorage.getItem('awardjetUser')) || { isLoggedIn: false, isPro: false };
        let currentAuthMode = 'signup';
        let stripe, cardElement;

        // ============================================
        // API CONFIGURATION
        // ============================================

        // IMPORTANT: Update this to your deployed backend URL
        // Local development: 'http://localhost:3001'
        // Production: https://awardjet-backend.onrender.com
        const API_URL = 'https://awardjet-backend.onrender.com';

        // ============================================
        // STRIPE INITIALIZATION
        // ============================================

        // This will be fetched from your backend
        let STRIPE_PUBLISHABLE_KEY = null;

        async function initStripe() {
            // Fetch publishable key from backend
            if (!STRIPE_PUBLISHABLE_KEY) {
                try {
                    const response = await fetch(`${API_URL}/config`);
                    const config = await response.json();
                    STRIPE_PUBLISHABLE_KEY = config.publishableKey;
                } catch (err) {
                    console.log('Backend not connected - using demo mode');
                }
            }

            // Demo mode if no key or backend not available
            if (!STRIPE_PUBLISHABLE_KEY || STRIPE_PUBLISHABLE_KEY.includes('YOUR_STRIPE')) {
                document.getElementById('card-element').innerHTML = `
                    <div class="flex items-center gap-3 text-slate-400">
                        <i class="fas fa-credit-card"></i>
                        <span class="text-sm">Card number</span>
                        <span class="ml-auto text-sm">MM/YY</span>
                        <span class="text-sm">CVC</span>
                    </div>
                `;
                console.log('ðŸ’¡ Demo mode: Connect backend for real payments');
                return;
            }

            stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
            const elements = stripe.elements();

            // Create card element with custom styling
            cardElement = elements.create('card', {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#1e293b',
                        fontFamily: 'Plus Jakarta Sans, system-ui, sans-serif',
                        '::placeholder': { color: '#94a3b8' }
                    },
                    invalid: { color: '#ef4444' }
                }
            });

            cardElement.mount('#card-element');

            // Handle card errors
            cardElement.on('change', (event) => {
                const errorEl = document.getElementById('card-errors');
                if (event.error) {
                    errorEl.textContent = event.error.message;
                    errorEl.classList.remove('hidden');
                } else {
                    errorEl.classList.add('hidden');
                }
            });
        }

        // ============================================
        // AUTH & SUBSCRIPTION
        // ============================================

        function openAuth(mode) {
            currentAuthMode = mode;
            document.getElementById('auth-modal').classList.remove('hidden');

            // Update UI based on mode
            const isSignup = mode === 'signup';
            document.getElementById('auth-title').textContent = isSignup ? 'Start Your Free Trial' : 'Welcome Back';
            document.getElementById('auth-subtitle').textContent = isSignup ? '7 days free, then $10/month' : 'Sign in to your account';
            document.getElementById('name-field').style.display = isSignup ? 'block' : 'none';
            document.getElementById('card-section').style.display = isSignup ? 'block' : 'none';
            document.getElementById('trial-timeline').style.display = isSignup ? 'block' : 'none';
            document.getElementById('submit-text').textContent = isSignup ? 'Start Free Trial' : 'Log In';

            // Initialize Stripe when modal opens for signup
            if (isSignup && !stripe) {
                setTimeout(initStripe, 100);
            }
        }

        function closeAuth() {
            document.getElementById('auth-modal').classList.add('hidden');
        }

        async function handleAuth(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('auth-submit-btn');
            const submitText = document.getElementById('submit-text');
            const spinner = document.getElementById('submit-spinner');

            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = currentAuthMode === 'signup' ? 'Setting up your trial...' : 'Signing in...';
            spinner.classList.remove('hidden');

            try {
                if (currentAuthMode === 'signup') {
                    const email = document.getElementById('auth-email').value;
                    const name = document.getElementById('auth-name').value;

                    // For signup, we need to create a payment method with Stripe
                    if (stripe && cardElement) {
                        const { paymentMethod, error } = await stripe.createPaymentMethod({
                            type: 'card',
                            card: cardElement,
                            billing_details: { name, email }
                        });

                        if (error) {
                            throw new Error(error.message);
                        }

                        // Send to backend to create subscription
                        const response = await fetch(`${API_URL}/create-subscription`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                email,
                                name,
                                paymentMethodId: paymentMethod.id
                            })
                        });

                        const result = await response.json();

                        if (!response.ok) {
                            throw new Error(result.error || 'Failed to create subscription');
                        }

                        console.log('âœ… Subscription created:', result.subscriptionId);

                        userState.customerId = result.customerId;
                        userState.subscriptionId = result.subscriptionId;
                        userState.trialEnds = result.trialEnd;
                    } else {
                        // Demo mode - simulate success
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        userState.trialEnds = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();
                    }

                    userState.isLoggedIn = true;
                    userState.isPro = true;
                    userState.email = email;

                    showToast('ðŸŽ‰ Welcome! Your 7-day free trial has started.', 'success');
                } else {
                    // Login flow
                    await new Promise(resolve => setTimeout(resolve, 800));

                    userState.isLoggedIn = true;
                    userState.email = document.getElementById('auth-email').value;

                    showToast('Welcome back!', 'success');
                }

                localStorage.setItem('awardjetUser', JSON.stringify(userState));
                document.getElementById('login-btn').innerHTML = `<i class="fas fa-user-circle mr-2"></i>${userState.email.split('@')[0]}`;
                closeAuth();

            } catch (error) {
                showToast(error.message || 'Something went wrong. Please try again.', 'error');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitText.textContent = currentAuthMode === 'signup' ? 'Start Free Trial' : 'Log In';
                spinner.classList.add('hidden');
            }
        }

        function handleSubscribe() {
            openAuth('signup');
        }

        // ============================================
        // TABS
        // ============================================

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(el => {
                el.classList.remove('tab-active');
                el.classList.add('text-slate-600');
            });
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');
            document.getElementById(`tab-${tabName}`).classList.remove('text-slate-600');
        }

        // ============================================
        // SEARCH
        // ============================================

        function searchFlights() {
            const origin = document.getElementById('origin').value.toUpperCase();
            const destination = document.getElementById('destination').value.toUpperCase();
            const date = document.getElementById('travel-date').value;
            const cabinClass = document.getElementById('cabin-class').value;
            const route = `${origin}-${destination}`;
            const results = [];

            // Direct programs
            for (const [programId, program] of Object.entries(loyaltyPrograms)) {
                if (awardCharts[programId]?.[route]) {
                    const points = awardCharts[programId][route][cabinClass];
                    if (points) {
                        const cashPrice = cashPrices[route]?.[cabinClass] || 3000;
                        results.push({
                            programId, program: program.name, code: program.code, color: program.color,
                            points, cpp: (cashPrice / points * 100).toFixed(2), airline: program.airline,
                            origin, destination, date, cabinClass, route
                        });
                    }
                }
            }

            // Transfer partners
            ['chase', 'amex'].forEach(bank => {
                loyaltyPrograms[bank].transferPartners.forEach(partner => {
                    if (awardCharts[partner]?.[route]) {
                        const points = awardCharts[partner][route][cabinClass];
                        if (points && !results.some(r => r.programId === partner && r.transferFrom === bank)) {
                            const cashPrice = cashPrices[route]?.[cabinClass] || 3000;
                            results.push({
                                programId: partner, program: loyaltyPrograms[partner].name,
                                code: loyaltyPrograms[partner].code, color: loyaltyPrograms[partner].color,
                                points, cpp: (cashPrice / points * 100).toFixed(2),
                                airline: loyaltyPrograms[partner].airline,
                                transferFrom: bank, transferFromName: loyaltyPrograms[bank].name,
                                origin, destination, date, cabinClass, route
                            });
                        }
                    }
                });
            });

            results.sort((a, b) => a.points - b.points);
            displayResults(results, origin, destination);
        }

        function displayResults(results, origin, dest) {
            document.getElementById('result-route').textContent = `${origin} â†’ ${dest}`;
            document.getElementById('result-count').textContent = `(${results.length} booking options)`;

            document.getElementById('results-list').innerHTML = results.map((r, i) => {
                const valueClass = r.cpp >= 3 ? 'value-excellent' : r.cpp >= 2 ? 'value-good' : 'value-fair';
                const airlineConfig = AIRLINE_URLS[r.programId];
                const deepLinkBadge = airlineConfig?.supportsDeepLink
                    ? '<span class="ml-2 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">Route pre-filled</span>'
                    : '';

                return `
                    <div class="bg-white border border-slate-200 rounded-2xl p-5 card-hover fade-up" style="animation-delay: ${i * 0.05}s">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div class="flex items-center gap-4">
                                <div class="program-badge" style="background-color: ${r.color}">${r.code}</div>
                                <div>
                                    <div class="font-bold text-slate-900">${r.program}${deepLinkBadge}</div>
                                    <div class="text-sm text-slate-500">${r.transferFrom ? `Transfer from ${r.transferFromName}` : `Book on ${r.airline}`}</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-6">
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-slate-900">${r.points.toLocaleString()}</div>
                                    <div class="text-sm text-slate-500">points</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold ${valueClass}">${r.cpp}Â¢/pt</div>
                                    <div class="text-xs text-slate-400">value</div>
                                </div>
                                <button onclick='openBookingModal(${JSON.stringify(r).replace(/'/g, "&#39;")})'
                                    class="px-5 py-2.5 gradient-brand text-white rounded-xl font-semibold hover:shadow-lg transition-all">
                                    Book <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('search-results').classList.remove('hidden');
        }

        // ============================================
        // BOOKING MODAL
        // ============================================

        function openBookingModal(result) {
            const airlineConfig = AIRLINE_URLS[result.programId];

            document.getElementById('booking-route-display').textContent =
                `${result.origin} â†’ ${result.destination} â€¢ ${result.cabinClass.charAt(0).toUpperCase() + result.cabinClass.slice(1)} Class`;

            document.getElementById('booking-details').innerHTML = `
                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl">
                    <div class="flex items-center gap-3">
                        <div class="program-badge" style="background-color: ${result.color}">${result.code}</div>
                        <div>
                            <div class="font-bold text-slate-900">${result.program}</div>
                            <div class="text-sm text-slate-500">${result.airline || result.program}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-slate-900">${result.points.toLocaleString()}</div>
                        <div class="text-sm text-slate-500">points needed</div>
                    </div>
                </div>
            `;

            const bookingUrl = airlineConfig.buildUrl(result.origin, result.destination, result.date, result.cabinClass);

            let optionsHTML = `
                <a href="${bookingUrl}" target="_blank" rel="noopener" onclick="trackClick('${result.programId}')"
                    class="block w-full gradient-brand text-white py-4 rounded-xl font-bold text-center hover:shadow-lg transition-all">
                    <i class="fas fa-plane-departure mr-2"></i>
                    Open ${airlineConfig.name}
                    <i class="fas fa-external-link-alt ml-2 text-xs opacity-70"></i>
                </a>
            `;

            if (airlineConfig.note) {
                optionsHTML += `<p class="text-center text-sm text-slate-500 mt-2">${airlineConfig.note}</p>`;
            }

            if (!airlineConfig.supportsDeepLink && airlineConfig.manualInstructions) {
                optionsHTML += `
                    <div class="mt-4 p-4 bg-blue-50 rounded-xl">
                        <p class="text-sm text-blue-800"><strong>Manual steps:</strong> ${airlineConfig.manualInstructions}</p>
                    </div>
                `;
            }

            if (result.transferFrom) {
                const transferConfig = AIRLINE_URLS[result.transferFrom];
                if (transferConfig) {
                    optionsHTML += `
                        <div class="border-t border-slate-200 pt-4 mt-4">
                            <p class="text-sm text-slate-600 mb-3"><strong>Step 1:</strong> Transfer ${result.points.toLocaleString()} points from ${result.transferFromName}</p>
                            <a href="${transferConfig.buildUrl()}" target="_blank" rel="noopener" onclick="trackClick('${result.transferFrom}')"
                                class="block w-full py-3 border-2 border-brand-500 text-brand-700 rounded-xl font-semibold text-center hover:bg-brand-50 transition-all">
                                <i class="fas fa-exchange-alt mr-2"></i>
                                Open ${result.transferFromName}
                            </a>
                        </div>
                    `;
                }
            }

            document.getElementById('booking-options').innerHTML = optionsHTML;
            document.getElementById('booking-modal').classList.remove('hidden');
        }

        function closeBookingModal() {
            document.getElementById('booking-modal').classList.add('hidden');
        }

        function trackClick(programId) {
            console.log('ðŸ“Š Affiliate click:', programId, new Date().toISOString());
            // In production: send to your tracking server
        }

        // ============================================
        // UTILITIES
        // ============================================

        function showToast(message, type = 'info') {
            const colors = { success: 'bg-green-600', warning: 'bg-amber-500', error: 'bg-red-500', info: 'bg-brand-600' };
            const toast = document.createElement('div');
            toast.className = `${colors[type]} text-white px-6 py-4 rounded-xl shadow-lg fade-up`;
            toast.innerHTML = message;
            document.getElementById('toast-container').appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        // ============================================
        // INIT
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            const future = new Date();
            future.setMonth(future.getMonth() + 2);
            document.getElementById('travel-date').value = future.toISOString().split('T')[0];

            if (userState.isLoggedIn) {
                document.getElementById('login-btn').innerHTML = `<i class="fas fa-user-circle mr-2"></i>${userState.email?.split('@')[0] || 'User'}`;
            }

            searchFlights();
        });

        document.getElementById('auth-modal').addEventListener('click', e => { if (e.target.id === 'auth-modal') closeAuth(); });
        document.getElementById('booking-modal').addEventListener('click', e => { if (e.target.id === 'booking-modal') closeBookingModal(); });
    </script>
</body>
</html>
